DROP DATABASE IF EXISTS SwaGGedDB;
CREATE DATABASE SwaGGedDB;
USE SwaGGedDB;

DROP TABLE IF EXISTS utente;
CREATE TABLE utente (
    email           varchar(30)     NOT NULL,
    username        varchar(20)     NOT NULL,
    password        varchar(64)     NOT NULL,
    immagine        varchar(512)    NOT NULL DEFAULT "noPfp.jpg",
    segnalazioni    int             NOT NULL DEFAULT '0',
    bandito         tinyint(1)      NOT NULL DEFAULT '0',
    admin           tinyint(1)      NOT NULL DEFAULT '0',
    PRIMARY KEY (email),
    UNIQUE (username)
);

DROP TABLE IF EXISTS community;
CREATE TABLE community (
    nome            varchar(20)     NOT NULL,
    descrizione     varchar(512)    NOT NULL DEFAULT "",
    segnalazioni    int             NOT NULL DEFAULT '0',
    iscritti		int				NOT NULL DEFAULT '0',
    utenteEmail     varchar(30)     NOT NULL,
    PRIMARY KEY (nome),
    FOREIGN KEY (utenteEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE
);

DROP TABLE IF EXISTS post;
CREATE TABLE post (
    id              int             NOT NULL AUTO_INCREMENT,
    titolo          varchar(50)     NOT NULL,
    corpo           varchar(512)    DEFAULT "",
    immagine        varchar(512)    DEFAULT "",
    segnalazioni    int             NOT NULL DEFAULT '0',
    likes           int             NOT NULL DEFAULT '0',
    dataCreazione   datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP,
    numeroCommenti	int				NOT NULL DEFAULT '0',
    utenteEmail     varchar(30)     NOT NULL,
    communityNome   varchar(20)     NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (utenteEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (communityNome) REFERENCES community(nome) ON UPDATE CASCADE ON DELETE CASCADE
);

DROP TABLE IF EXISTS commento;
CREATE TABLE commento (
    id              int             NOT NULL AUTO_INCREMENT,
    corpo           varchar(512)    NOT NULL DEFAULT "",
    segnalazioni    int             NOT NULL DEFAULT '0',
    utenteEmail     varchar(30)     NOT NULL,
    postId          int             NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (utenteEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (postId) REFERENCES post(id) ON UPDATE CASCADE ON DELETE CASCADE
);
/*
DROP TABLE IF EXISTS segnalaUtente;
CREATE TABLE segnalaUtente (
    segnalatoreEmail varchar(30)     NOT NULL,
    segnalatoEmail   varchar(30)     NOT NULL,
    PRIMARY KEY (segnalatoreEmail, segnalatoEmail),
    FOREIGN KEY (segnalatoreEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (segnalatoEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE
);

DROP TABLE IF EXISTS segueUtente;
CREATE TABLE segueUtente (
    seguaceEmail    varchar(30)     NOT NULL,
    seguitoEmail    varchar(30)     NOT NULL,
    PRIMARY KEY (seguaceEmail, seguitoEmail),
    FOREIGN KEY (seguaceEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (seguitoEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE
);

DROP TABLE IF EXISTS segnalaCommunity;
CREATE TABLE segnalaCommunity (
    utenteEmail     varchar(30)     NOT NULL,
    communityId     int             NOT NULL,
    PRIMARY KEY (utenteEmail, communityId),
    FOREIGN KEY (utenteEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (communityId) REFERENCES community(id) ON UPDATE CASCADE ON DELETE CASCADE
);
*/
DROP TABLE IF EXISTS iscrivitiCommunity;
CREATE TABLE iscrivitiCommunity (
    utenteEmail     varchar(30)     NOT NULL,
    communityNome   varchar(20)		NOT NULL,
    PRIMARY KEY (utenteEmail, communityNome),
    FOREIGN KEY (utenteEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (communityNome) REFERENCES community(nome) ON UPDATE CASCADE ON DELETE CASCADE
);
/*
DROP TABLE IF EXISTS segnalaPost;
CREATE TABLE segnalaPost (
    utenteEmail     varchar(30)     NOT NULL,
    postId          int             NOT NULL,
    PRIMARY KEY (utenteEmail, postId),
    FOREIGN KEY (utenteEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (postId) REFERENCES post(id) ON UPDATE CASCADE ON DELETE CASCADE
);
*/
DROP TABLE IF EXISTS apprezzaPost;
CREATE TABLE apprezzaPost (
    utenteEmail     varchar(30)     NOT NULL,
    postId          int             NOT NULL,
    PRIMARY KEY (utenteEmail, postId),
    FOREIGN KEY (utenteEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (postId) REFERENCES post(id) ON UPDATE CASCADE ON DELETE CASCADE
);
/*
DROP TABLE IF EXISTS salvaPost;
CREATE TABLE salvaPost (
    utenteEmail     varchar(30)     NOT NULL,
    postId          int             NOT NULL,
    PRIMARY KEY (utenteEmail, postId),
    FOREIGN KEY (utenteEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (postId) REFERENCES post(id) ON UPDATE CASCADE ON DELETE CASCADE
);

DROP TABLE IF EXISTS segnalaCommento;
CREATE TABLE segnalaCommento (
    utenteEmail     varchar(30)     NOT NULL,
    commentoId      int             NOT NULL,
    PRIMARY KEY (utenteEmail, commentoId),
    FOREIGN KEY (utenteEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (commentoId) REFERENCES commento(id) ON UPDATE CASCADE ON DELETE CASCADE
);

DROP TABLE IF EXISTS apprezzaCommento;
CREATE TABLE apprezzaCommento (
    utenteEmail     varchar(30)     NOT NULL,
    commentoId      int             NOT NULL,
    apprezzamento	int				NOT NULL DEFAULT '0',
    PRIMARY KEY (utenteEmail, commentoId),
    FOREIGN KEY (utenteEmail) REFERENCES utente(email) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (commentoId) REFERENCES commento(id) ON UPDATE CASCADE ON DELETE CASCADE
);
*/
INSERT INTO utente(email, username, password, immagine, segnalazioni, bandito, admin) VALUES
("Email@email.email", "Username", "UGFzc3dvcmQ=", "noPfp.jpg", 0, 0, 0); -- Password: Password

-- Insert a user (if not already done, use your existing user insert statement if desired)
INSERT INTO utente (email, username, password, immagine, segnalazioni, bandito, admin) 
VALUES ("testuser@email.com", "TestUser", "aGVsbG9Ad29ybGQ=", "noPfp.jpg", 0, 0, 0); -- Password: hello@world

-- Insert another user
INSERT INTO utente (email, username, password, immagine, segnalazioni, bandito, admin) 
VALUES ("admin@email.com", "AdminUser", "YWRtaW5wYXNz", "noPfp.jpg", 0, 0, 1); -- Password: adminpass

-- Insert a community
INSERT INTO community (nome, descrizione, segnalazioni, utenteEmail) 
VALUES ("Test Community", "This is a test community description", 0, "testuser@email.com");

INSERT INTO iscrivitiCommunity(utenteEmail, communityNome) VALUES
("Email@email.email", "Test Community");

-- Now, insert a post into the `post` table. Use the last inserted community ID.
INSERT INTO post (titolo, corpo, immagine, segnalazioni, likes, utenteEmail, communityNome) VALUES 
("Test Post Title 1", "This is the body of the first test post.", "", 0, 10, "testuser@email.com", "Test Community"),
("Test Post Title 2", "This is the body of the second test post.", "", 0, 5, "testuser@email.com", "Test Community"),
("POST MIO", "MIO POST", "", 0, 5, "Email@email.email", "Test Community"),
("Test Post Title 3", "This is the body of the third test post.", "", 0, 3, "admin@email.com", "Test Community");

INSERT INTO commento (corpo, segnalazioni, utenteEmail, postId) VALUES
("Questo è un commento interessante! Grazie per averlo condiviso.", 0, "testuser@email.com", 1),
("Non sono d'accordo con quanto scritto, ma rispetto la tua opinione.", 0, "admin@email.com", 1),
("Mi piacerebbe sapere di più su questo argomento.", 0, "Email@email.email", 1),
("Ottimo lavoro! Continua così!", 0, "testuser@email.com", 1),
("Questo post mi ha fatto riflettere. Hai qualche risorsa da consigliare?", 0, "admin@email.com", 1),
("Mi puoi eliminare?", 0, "Email@email.email", 1);